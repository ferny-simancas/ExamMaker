<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Ex√°menes Sagrada Familia</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #2563eb; --bg: #f3f4f6; --font-main: 'Montserrat', sans-serif; --header-color: #0a2445; }
        body { font-family: var(--font-main); background: var(--bg); margin: 0; padding: 20px; color: #000; }
        
        /* --- ESTILOS DE PANTALLA --- */
        .container { max-width: 900px; min-height: 1200px; margin: 0 auto; background: white; padding: 40px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        
        /* === ENCABEZADO (Borde Azul, Fondo Blanco) === */
        header { 
            background-color: white; 
            border: 3px solid var(--header-color); 
            color: #333; 
            margin-bottom: 20px; 
            padding: 15px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-radius: 3px; 
        }
        
        /* Secci√≥n Izquierda (Escudo) */
        .header-left { width: 100px; display: flex; justify-content: flex-start; }
        .logo-img { width: 85px; height: 85px; object-fit: contain; }
        
        /* Secci√≥n Centro (Texto) */
        .header-center { flex-grow: 1; text-align: center; padding: 0 10px; }
        .header-center h1 { 
            font-size: 18px; 
            font-weight: 700; 
            margin: 0; 
            line-height: 1.2; 
            text-transform: uppercase; 
            color: var(--header-color); 
        }
        .header-center .motto { 
            font-size: 11px; 
            font-style: italic; 
            margin: 5px 0 10px 0; 
            font-weight: 500; 
            color: #555; 
        }
        .header-center h2 { 
            font-size: 14px; 
            font-weight: 600; 
            margin: 0; 
            text-transform: uppercase; 
            color: #333; 
            border-bottom: 1px dashed #999; 
            display: inline-block; 
            padding-bottom: 2px;
        }

        /* Secci√≥n Derecha (Icontec) */
        .header-right { width: 100px; display: flex; justify-content: flex-end; align-items: center; }
        .icontec-img { width: 90px; height: 90px; object-fit: contain; display: block; }

        /* Informaci√≥n */
        .info-container { display: flex; flex-direction: column; gap: 8px; margin-bottom: 25px; width: 100%; }
        .info-row { display: flex; gap: 20px; width: 100%; }
        .info-field { display: flex; align-items: flex-end; }
        .info-field label { font-weight: 700; font-size: 11px; margin-right: 5px; white-space: nowrap; padding-bottom: 2px;}
        .field-large { flex: 7; } .field-small { flex: 3; } 
        .info-field input { width: 100%; border: none; border-bottom: 1px solid #000; background: transparent; font-size: 12px; outline: none; font-family: var(--font-main); height: 18px; }

        /* Preguntas */
        .question-list { counter-reset: question-counter; list-style: none; padding: 0; }
        .question-item { border: 1px solid #e5e7eb; margin-bottom: 15px; padding: 15px; border-radius: 8px; background: #fff; position: relative; }
        
        .question-number { font-weight: 700; margin-bottom: 5px; display: block; }
        
        /* No numerar Imagen, Texto Libre NI Lectura */
        .question-item:not([data-type="image"]):not([data-type="free_text"]):not([data-type="reading"]) .question-number::before { 
            counter-increment: question-counter; 
            content: counter(question-counter) ". "; 
        }

        .edit-input, textarea { width: 100%; box-sizing: border-box; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; margin-bottom: 5px; background: #fff; }
        .option-row { display: flex; align-items: center; gap: 5px; margin-bottom: 5px; }
        .option-letter { font-weight: 600; min-width: 20px; }
        .img-preview { max-width: 100%; max-height: 400px; display: block; margin: 10px auto; }
        .img-controls { background: #f0f9ff; padding: 10px; border-radius: 4px; border: 1px dashed #0284c7; text-align: center; }

        /* --- CONTROLES --- */
        .controls { position: sticky; top: 10px; background: #fff; padding: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 100; margin-bottom: 20px; border-radius: 8px; display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
        .control-group { display: flex; gap: 5px; align-items: center; border-right: 1px solid #ddd; padding-right: 10px; margin-right: 5px; }
        button { padding: 8px 12px; cursor: pointer; border: none; border-radius: 4px; font-weight: 600; font-family: var(--font-main); font-size: 12px; transition: 0.2s; }
        button:hover { opacity: 0.9; }
        
        .btn-add { background: var(--primary); color: white; }
        .btn-print { background: #059669; color: white; }
        .btn-save { background: #d97706; color: white; }
        .btn-lang { background: #4f46e5; color: white; }
        .btn-new { background: #0891b2; color: white; }
        .btn-del-exam { background: #be123c; color: white; }
        .btn-del { background: #dc2626; color: white; font-size: 11px; margin-top: 5px; }
        .btn-upload { background: #6366f1; color: white; margin: 0 5px; }
        .btn-link { background: #8b5cf6; color: white; margin: 0 5px; }
        .btn-free-text { background: #64748b; color: white; }
        .btn-icontec { background: #d97706; color: white; }

        select { padding: 8px; border-radius: 4px; border: 1px solid #ccc; max-width: 150px; }

        /* =========================================
           IMPRESI√ìN
           ========================================= */
        @media print {
            @page { size: Legal; margin: 1.5cm 1.5cm 1.5cm 1.5cm; }
            body { 
                background: white; padding: 0; margin: 0; 
                font-size: 10pt !important; 
                -webkit-print-color-adjust: exact; 
                print-color-adjust: exact;
                height: auto; 
            }
            .container { box-shadow: none; max-width: 100%; padding: 0; margin: 0; }
            .controls, .btn-del, select, .no-print-label, .img-controls { display: none !important; }
            
            /* Header Impresi√≥n */
            header { 
                background-color: white !important;
                border: 3px solid var(--header-color) !important;
                -webkit-print-color-adjust: exact; 
                border-radius: 0; 
            }

            .question-list { column-count: 2; column-gap: 30px; width: 100%; display: block; column-fill: auto; height: auto; }
            .question-item { border: none; padding: 0; margin-bottom: 20px; page-break-inside: avoid; break-inside: avoid; }
            .question-item[data-type="free_text"] textarea { font-style: normal; font-weight: 500; text-align: justify; }
            
            textarea, .edit-input { border: none; padding: 0; margin: 0; resize: none; background: transparent; font-family: 'Montserrat', sans-serif; font-size: 10pt; line-height: 1.3; overflow: hidden; }
            .option-row input[type="text"] { border-bottom: none; }
            .reading-text { border: 1px solid #ccc; padding: 5px; font-size: 9pt; text-align: justify; }
            .info-field input { border-bottom: 1px solid #000 !important; }
        }
    </style>
</head>
<body>

    <div class="controls">
        <div class="control-group">
            <select id="examSelect" onchange="loadSelectedExam()"></select>
            <button class="btn-new" onclick="createNewExam()">‚ûï Nuevo</button>
            <button class="btn-save" onclick="saveExam()">üíæ Guardar</button>
            <button class="btn-del-exam" onclick="deleteCurrentExam()">üóëÔ∏è Eliminar</button>
        </div>

        <div class="control-group">
            <button class="btn-lang" onclick="toggleLang()">üåê ES/EN</button>
            <button class="btn-icontec" onclick="toggleIcontec()">üèÜ Icontec</button>
            <button class="btn-print" onclick="window.print()">üñ®Ô∏è Imprimir</button>
        </div>

        <button class="btn-add btn-q-multi" onclick="addQ('multiple')">+ Selecci√≥n</button>
        <button class="btn-add btn-q-read" onclick="addQ('reading')">+ Lectura</button>
        <button class="btn-add btn-q-dev" onclick="addQ('dev')">+ Abierta</button>
        <button class="btn-add btn-q-img" onclick="addQ('image')" style="background: #db2777;">+ Imagen</button>
        <button class="btn-free-text btn-q-text" onclick="addQ('free_text')">+ Texto</button>
    </div>

    <div class="container">
        <header>
            <div class="header-left">
                <img src="https://blogger.googleusercontent.com/img/a/AVvXsEgVEVyIp0mFTTIhcaIPduf4e-Mx-hTVySTbFBT-4jsrBEfNnCxqZHSaWUDJHjo5_wxYZxEDlSDrYHsHVesSoS8ajhZIUtkSqxEccS7VwBLwea46j9zedfTgGXoX-7_HZUI4Nw6-c8_p9hCL6P8ekTPInfYroWVHjl1_Cs1BUYnW2LvnLuzWPVMneO69-KW8" class="logo-img" alt="Escudo">
            </div>
            
            <div class="header-center">
                <h1>COLEGIO DE LA SAGRADA FAMILIA</h1>
                <p class="motto">"Acompa√±ando con amor, educamos el coraz√≥n"</p>
                <h2 id="examTitle" contenteditable="true">EVALUACI√ìN DE PERIODO</h2>
            </div>
            
            <div class="header-right">
                <img id="icontecLogo" src="https://barranquilla.gov.co/wp-content/uploads/2020/11/ico-cert-procesos.png" class="icontec-img" alt="Certificaci√≥n Icontec">
            </div>
        </header>

        <div class="info-container">
            <div class="info-row">
                <div class="info-field field-large">
                    <label id="lbl-student">ESTUDIANTE:</label>
                    <input type="text">
                </div>
                <div class="info-field field-small">
                    <label id="lbl-date">FECHA:</label>
                    <input type="text">
                </div>
            </div>
            <div class="info-row">
                <div class="info-field field-large">
                    <label id="lbl-teacher">DOCENTE:</label>
                    <input type="text">
                </div>
                <div class="info-field field-small">
                    <label id="lbl-grade">CURSO:</label>
                    <input type="text">
                </div>
            </div>
        </div>

        <div id="qContainer" class="question-list"></div>
    </div>

    <script>
        const container = document.getElementById('qContainer');
        const examSelect = document.getElementById('examSelect');
        const INDEX_KEY = 'exam_index_v2';
        
        let currentLang = 'es';
        const t = {
            es: {
                student: "ESTUDIANTE:", date: "FECHA:", grade: "CURSO:", teacher: "DOCENTE:",
                titleDefault: "EVALUACI√ìN DE PERIODO",
                ph_q: "Enunciado...", ph_opt: "Opci√≥n", ph_read: "Texto de lectura...", 
                ph_subq: "Responda las siguientes preguntas de acuerdo con el texto:",
                ph_free: "Escribe aqu√≠ instrucciones, p√°rrafos o texto libre...",
                lbl_print: "(Espacio respuesta al imprimir)",
                btn_multi: "+ Selecci√≥n", btn_read: "+ Lectura", btn_dev: "+ Abierta", btn_img: "+ Imagen", btn_text: "+ Texto",
                alert_save: "Examen guardado: ", alert_del: "¬øSeguro eliminar?",
                prompt_new: "Escribe un nombre para este nuevo examen:", alert_exists: "Ya existe un examen con ese nombre.",
                img_prompt_url: "Pega el enlace de la imagen:",
                btn_upload: "üìÇ Subir Foto", btn_link: "üîó Pegar URL"
            },
            en: {
                student: "STUDENT:", date: "DATE:", grade: "GRADE:", teacher: "TEACHER:",
                titleDefault: "TERM EXAM",
                ph_q: "Question text...", ph_opt: "Option", ph_read: "Reading text...", 
                ph_subq: "Answer the following questions based on the text:",
                ph_free: "Write instructions, paragraphs or free text here...",
                lbl_print: "(Answer space when printing)",
                btn_multi: "+ Multiple Choice", btn_read: "+ Reading", btn_dev: "+ Open Question", btn_img: "+ Image", btn_text: "+ Text",
                alert_save: "Exam saved: ", alert_del: "Confirm delete?",
                prompt_new: "Enter name for this new exam:", alert_exists: "Already exists.",
                img_prompt_url: "Paste image URL:",
                btn_upload: "üìÇ Upload File", btn_link: "üîó Paste URL"
            }
        };

        function toggleIcontec() {
            const img = document.getElementById('icontecLogo');
            img.style.display = (img.style.display === 'none') ? 'block' : 'none';
        }

        function getExamList() {
            const list = localStorage.getItem(INDEX_KEY);
            return list ? JSON.parse(list) : [];
        }

        function updateExamSelect(selectedName = null) {
            const list = getExamList();
            examSelect.innerHTML = '';
            const defaultOpt = document.createElement('option');
            defaultOpt.value = "";
            defaultOpt.text = list.length === 0 ? "(Sin ex√°menes - Escribe y Guarda)" : "(Seleccionar o Crear Nuevo)";
            examSelect.add(defaultOpt);
            list.forEach(name => {
                const opt = document.createElement('option');
                opt.value = name;
                opt.text = name;
                examSelect.add(opt);
            });
            if (selectedName && list.includes(selectedName)) examSelect.value = selectedName;
        }

        function createNewExam() {
            if(confirm("¬øDeseas limpiar la pantalla para crear un examen nuevo?")) {
                examSelect.value = "";
                container.innerHTML = '';
                document.getElementById('examTitle').innerText = t[currentLang].titleDefault;
                document.querySelectorAll('.info-field input').forEach(i => i.value = '');
                document.getElementById('icontecLogo').style.display = 'block'; 
            }
        }

        function saveExam() {
            let name = examSelect.value;
            const lang = t[currentLang];
            if (!name) {
                name = prompt(lang.prompt_new);
                if (!name) return; 
                const list = getExamList();
                if (list.includes(name)) { alert(lang.alert_exists); return; }
                list.push(name);
                localStorage.setItem(INDEX_KEY, JSON.stringify(list));
                updateExamSelect(name);
            }
            saveExamData(name);
            alert(lang.alert_save + name);
        }

        function deleteCurrentExam() {
            const name = examSelect.value;
            if (!name) return;
            if (confirm(t[currentLang].alert_del)) {
                localStorage.removeItem('EXAM_' + name);
                let list = getExamList();
                list = list.filter(item => item !== name);
                localStorage.setItem(INDEX_KEY, JSON.stringify(list));
                updateExamSelect();
                container.innerHTML = ''; 
            }
        }

        function saveExamData(name) {
            const data = [];
            document.querySelectorAll('.question-item').forEach(item => {
                const type = item.dataset.type;
                let qData = { type };
                if (type === 'image') qData.src = item.querySelector('img').src;
                else if (type === 'free_text') qData.text = item.querySelector('.q-text').value;
                else {
                    qData.text = item.querySelector('.q-text')?.value || '';
                    if (type === 'multiple') qData.options = Array.from(item.querySelectorAll('.option-row input')).map(i => i.value);
                    else if (type === 'reading') qData.reading = item.querySelector('.q-reading').value;
                }
                data.push(qData);
            });
            const infoInputs = Array.from(document.querySelectorAll('.info-field input')).map(i => i.value);
            const titleText = document.getElementById('examTitle').innerText;
            const icontecVisible = document.getElementById('icontecLogo').style.display !== 'none';
            const fullData = { questions: data, title: titleText, info: infoInputs, lang: currentLang, icontec: icontecVisible };
            localStorage.setItem('EXAM_' + name, JSON.stringify(fullData));
        }

        function loadSelectedExam() {
            const name = examSelect.value;
            if (!name) return;
            const saved = JSON.parse(localStorage.getItem('EXAM_' + name));
            container.innerHTML = '';
            if (saved) {
                if(saved.lang) { currentLang = saved.lang; applyLang(); }
                if(saved.title) document.getElementById('examTitle').innerText = saved.title;
                const icontecImg = document.getElementById('icontecLogo');
                if(saved.icontec === false) icontecImg.style.display = 'none'; else icontecImg.style.display = 'block';
                if(saved.questions) saved.questions.forEach(q => addQ(q.type, q));
                if(saved.info) {
                    const inputs = document.querySelectorAll('.info-field input');
                    saved.info.forEach((val, i) => { if(inputs[i]) inputs[i].value = val; });
                }
            } else { applyLang(); }
        }

        function toggleLang() { currentLang = currentLang === 'es' ? 'en' : 'es'; applyLang(); }
        function applyLang() {
            const lang = t[currentLang];
            document.getElementById('lbl-student').innerText = lang.student;
            document.getElementById('lbl-date').innerText = lang.date;
            document.getElementById('lbl-grade').innerText = lang.grade;
            document.getElementById('lbl-teacher').innerText = lang.teacher;
            document.querySelector('.btn-q-multi').innerText = lang.btn_multi;
            document.querySelector('.btn-q-read').innerText = lang.btn_read;
            document.querySelector('.btn-q-dev').innerText = lang.btn_dev;
            document.querySelector('.btn-q-img').innerText = lang.btn_img;
            document.querySelector('.btn-q-text').innerText = lang.btn_text;
            document.querySelectorAll('.btn-upload').forEach(b => b.innerText = lang.btn_upload);
            document.querySelectorAll('.btn-link').forEach(b => b.innerText = lang.btn_link);
            document.querySelectorAll('.question-item[data-type="free_text"] .q-text').forEach(tx => { tx.placeholder = lang.ph_free; });
            document.querySelectorAll('.question-item[data-type="reading"] .q-text').forEach(tx => { tx.placeholder = lang.ph_subq; });
            document.querySelectorAll('.question-item[data-type="reading"] .q-reading').forEach(tx => { tx.placeholder = lang.ph_read; });
        }

        function handleImageUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = input.closest('.question-item').querySelector('img');
                    img.src = e.target.result;
                    img.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        function handleImageURL(btn) {
            const url = prompt(t[currentLang].img_prompt_url);
            if(url) {
                const img = btn.closest('.question-item').querySelector('img');
                img.src = url;
                img.style.display = 'block';
            }
        }

        function addQ(type, content = null) {
            const div = document.createElement('div');
            div.className = 'question-item';
            div.dataset.type = type;
            const lang = t[currentLang];
            let html = `<span class="question-number"></span>`;
            if (type === 'multiple') {
                html += `<textarea class="q-text" rows="1" placeholder="${lang.ph_q}"></textarea>
                    <div class="options-container">${['A','B','C','D'].map(l => `<div class="option-row"><span class="option-letter">${l})</span><input type="text" class="edit-input" placeholder="${lang.ph_opt} ${l}"></div>`).join('')}</div>`;
            } else if (type === 'reading') {
                html += `<label class="no-print-label">Texto:</label><textarea class="q-reading reading-text" rows="5" placeholder="${lang.ph_read}"></textarea><textarea class="q-text" rows="2" placeholder="${lang.ph_subq}" style="margin-top:5px; font-weight:700;"></textarea><div style="margin-top:5px; border-top:1px dashed #ccc;"><span class="no-print-label" style="font-size:10px; color:blue;">${lang.lbl_print}</span><div style="height:30px;"></div></div>`;
            } else if (type === 'dev') {
                html += `<textarea class="q-text" rows="1" placeholder="${lang.ph_q}"></textarea><div class="lines-area"><div style="border-bottom:1px solid black; margin-top:18px;"></div><div style="border-bottom:1px solid black; margin-top:18px;"></div><div style="border-bottom:1px solid black; margin-top:18px;"></div></div>`;
            } else if (type === 'image') {
                html += `<div class="img-controls"><input type="file" accept="image/*" style="display:none" onchange="handleImageUpload(this)"><button class="btn-upload" onclick="this.previousElementSibling.click()">${lang.btn_upload}</button><button class="btn-link" onclick="handleImageURL(this)">${lang.btn_link}</button></div><img src="" class="img-preview" style="display:none;">`;
            } else if (type === 'free_text') {
                html += `<textarea class="q-text" rows="2" placeholder="${lang.ph_free}"></textarea>`;
            }
            html += `<button class="btn-del" onclick="this.parentElement.remove()">X</button>`;
            div.innerHTML = html;
            container.appendChild(div);
            if (content) {
                if(type === 'image' && content.src) { const img = div.querySelector('img'); img.src = content.src; img.style.display = 'block'; }
                if(type === 'free_text' && content.text) { div.querySelector('.q-text').value = content.text; autoResize(div.querySelector('.q-text')); }
                if(content.text && type !== 'free_text') { div.querySelector('.q-text').value = content.text; autoResize(div.querySelector('.q-text')); }
                if(content.reading) { div.querySelector('.q-reading').value = content.reading; autoResize(div.querySelector('.q-reading')); }
                if(content.options) { const inputs = div.querySelectorAll('.option-row input'); content.options.forEach((val, i) => inputs[i].value = val); }
            }
        }

        document.addEventListener('input', (e) => { if (e.target.tagName === 'TEXTAREA') autoResize(e.target); });
        function autoResize(el) { el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px'; }
        window.onload = function() { updateExamSelect(); };
    </script>
</body>
</html>